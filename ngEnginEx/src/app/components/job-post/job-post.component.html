<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js"
  integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>
<style>
  .accordion {
    background-color: #eee;
    color: #444;
    cursor: pointer;
    width: 100%;
    border: none;
    text-align: left;
    outline: none;
    font-size: 15px;
    transition: 0.4s;
  }

  .active,
  .accordion:hover {
    background-color: #ccc;
  }

  .panel {
    padding: 0 18px;
    display: none;
    background-color: white;
  }
</style>
<div style="margin-right: 10%; margin-left: 5%; margin-bottom: 1%;" *ngIf="!showNewJob">
  <td><button (click)="createNewPost()" class="btn btn-primary">Create New Job</button></td>
</div>
<div style="margin-right: 10%; margin-left: 5%">
  <div *ngIf="!selected && !showNewJob && !editJob" style="text-align: center">
    <table class="table table-striped table-hover table-bordered" *ngIf="getRoute()">
      <thead class="table-dark">
        <tr>
          <th>Job Requirements</th>
          <th>Job Start Date</th>
          <th>Job Completion Date</th>
          <th>Job Posted Date</th>
          <th>Job Status</th>
          <th>View Details</th>
          <th>Edit Job</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor='let job of jobPosts | userJob: activeUser'>
          <td>{{job.jobRequirements}}</td>
          <td>{{job.startDate}}</td>
          <td>{{job.completionDate}}</td>
          <td>{{job.datePosted}}</td>
          <td>{{job.status.name}}</td>
          <td><button (click)="displayJob(job)" class="btn btn-primary">View Job</button></td>
          <td><button (click)="setEditJob(job)" class="btn btn-primary">Edit Job</button></td>
        </tr>
      </tbody>
    </table>
    <table class="table table-striped table-hover table-bordered" *ngIf="!getRoute()">
      <thead class="table-dark">
        <tr>
          <th>Job Requirements</th>
          <th>Job Start Date</th>
          <th>Job Completion Date</th>
          <th>Job Posted Date</th>
          <th>Job Status</th>
          <th>View Details</th>
          <th>Edit Job</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor='let job of jobPosts | openJob'>
          <td>{{job.jobRequirements}}</td>
          <td>{{job.startDate}}</td>
          <td>{{job.completionDate}}</td>
          <td>{{job.datePosted}}</td>
          <td>{{job.status.name}}</td>
          <td><button (click)="displayJob(job)" class="btn btn-primary">View Job</button></td>
          <td><button (click)="setEditJob(job)" class="btn btn-primary">Edit Job</button></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div *ngIf="!selected && editJob">
    <form>
      <label>Job Requirements:</label>
      <input class="form-control form-control-lg" placeholder="Job Requirements" type="text" name="jobRequirements"
        [(ngModel)]="editJob.jobRequirements">
      <label>Start Date:</label>
      <input class="form-control form-control-lg" placeholder="Start Date" ype="date" min="2018-07-22"
        name="jobStartDate" [(ngModel)]="editJob.startDate">
      <label>Completion Date:</label>
      <input class="form-control form-control-lg" placeholder="Completion Date" ype="date" min="2018-07-22"
        name="jobCompletionDate" [(ngModel)]="editJob.completionDate">
      <ngb-accordion>
        <ngb-panel title="Job Status">
          <ng-template ngbPanelContent>
            <button (click)="setStatus(stat)" *ngFor='let stat of jobStatuses'>{{stat.name}}</button><br>
          </ng-template>
        </ngb-panel>
      </ngb-accordion>
      <label for="types">Choose a Job Type:</label>
      <ngb-accordion>
        <ngb-panel title="Job Types">
          <ng-template ngbPanelContent>
            <button (click)="setType(type)" *ngFor='let type of jobTypes'>{{type.name}}</button><br>
          </ng-template>
        </ngb-panel>
      </ngb-accordion>
      <button (click)="update(editJob)" class="btn btn-primary">Update Job Post</button>
    </form>
  </div>
  <div>
    <div *ngIf="showNewJob">
      <label>Job Requirements:</label>
      <input class="form-control form-control-lg" placeholder="Job Requirements" type="text" name="jobRequirements"
        [(ngModel)]="newJob.jobRequirements">
      <label>Start Date:</label>
      <input class="form-control form-control-lg" placeholder="Start Date" type="date" min="2018-07-22"
        name="jobStartDate" [(ngModel)]="newJob.startDate">
      <label>Completion Date:</label>
      <input class="form-control form-control-lg" placeholder="Completion Date" type="date" min="2018-07-22"
        name="jobCompletionDate" [(ngModel)]="newJob.completionDate">
      <label>Developers Needed:</label>
      <input class="form-control form-control-lg" placeholder="# of Developers Needed" type="number"
        name="jobDevelopersNeeded" [(ngModel)]="newJob.developersNeeded">
      <label for="status">Choose a Job Status:</label>
      <select name="status" [(ngModel)]="newJob.status">
        <option *ngFor="let stat of jobStatuses" [ngValue]="stat">{{stat.name}}</option>
      </select>
      <label for="jobType">Choose a Job Type:</label>
      <select name="jobType" [(ngModel)]="newJob.type">
        <option *ngFor="let type of jobTypes" [ngValue]="type">{{type.name}}</option>
      </select>
      <button (click)="createPreCall(newJob)" class="btn btn-primary">Create Job Post</button>
    </div>
    <div *ngIf="selected">
      <div>
        <ngb-accordion>
          <ngb-panel title="Job Info">
            <ng-template ngbPanelContent>
              <ul>
                <li>Job Description: {{selected.jobRequirements}}</li>
                <li>Approved Applicants Required: {{selected.developersNeeded}}</li>
                <li>Is Active: {{selected.jobActive}}</li>
                <li>Start Date: {{selected.startDate}}</li>
                <li>Completion Date: {{selected.completionDate}}</li>
                <li>Date Posted: {{selected.datePosted}}</li>
                <li>Status: {{selected.status.name}}</li>
              </ul>
            </ng-template>
          </ngb-panel>
        </ngb-accordion>
      </div>
      <div *ngIf="isOwner">
        <ngb-accordion>
          <ngb-panel title="Client Info">
            <ng-template ngbPanelContent>
              <ul>
                <li>First Name: {{selected.user.firstName}}</li>
                <li>Last Name: {{selected.user.lastName}}</li>
                <li>Email: {{selected.user.email}}</li>
                <li>Phone Number: {{selected.user.phoneNumber}}</li>
              </ul>
            </ng-template>
          </ngb-panel>
        </ngb-accordion>
      </div>
      <div *ngIf="isOwner">
        <ngb-accordion>
          <ngb-panel title="Applications">
            <ng-template ngbPanelContent>
              <ul *ngFor='let app of apps'>
                <li>ID: {{app.id}}</li>
                <li>First Name: {{app.user.firstName}}</li>
                <li>Last Name: {{app.user.lastName}}</li>
              </ul>
            </ng-template>
          </ngb-panel>
        </ngb-accordion>
      </div>
      <div *ngIf="!isOwner">
        <ngb-accordion>
          <ngb-panel title="Applications">
            <ng-template ngbPanelContent>
              <ul *ngFor='let app of apps'>
                <li>First Name: {{app.user.firstName}}</li>
                <li>Last Name: {{app.user.lastName}}</li>
                <li>Application Status: {{app.status}}</li>
                <li>Application Date: {{app.date}}</li>
                <li>Application Approved: {{app.approved}}</li>
                  <ngb-accordion>
                    <ngb-panel title="Applicant Experiences">
                      <ng-template ngbPanelContent>
                        <ul *ngFor='let exp of app.user.experiences'>
                          <li>Company Name: {{exp.companyName}}</li>
                          <li>Job Title: {{exp.jobTitle}}</li>
                          <li>Start Date: {{exp.startDate}}</li>
                          <li>End Date: {{exp.endDate}}</li>
                        </ul>
                      </ng-template>
                    </ngb-panel>
                  </ngb-accordion>
                  <ngb-accordion>
                    <ngb-panel title="Applicant Education">
                      <ng-template ngbPanelContent>
                        <ul *ngFor='let ed of app.user.educations'>
                          <li>Institution Name: {{ed.institutionName}}</li>
                          <li>Education Type: {{ed.educationType}}</li>
                          <li>Degree Type: {{ed.degreeCertificateName}}</li>
                          <li>Completed: {{ed.completeDate}}</li>
                        </ul>
                      </ng-template>
                    </ngb-panel>
                  </ngb-accordion>
                  <ngb-accordion>
                    <ngb-panel title="Applicant Skill">
                      <ng-template ngbPanelContent>
                        <ul *ngFor='let sk of app.user.skills'>
                          <li>Skill Description: {{sk.skillTitle}}</li>
                          <li>Skill Level: {{sk.skillLevel}}</li>
                        </ul>
                      </ng-template>
                    </ngb-panel>
                  </ngb-accordion>
                <div *ngIf="app.status == 'Open'">
                  <ngb-accordion>
                    <ngb-panel title="Application Actions">
                      <ng-template ngbPanelContent>
                        <ul>
                          <button (click)="approveApplication(app)" class="btn sm btn-primary">Approve
                            Application</button>
                          <button (click)="declineApplication(app)" class="btn sm btn-primary">Decline
                            Application</button>
                        </ul>
                      </ng-template>
                    </ngb-panel>
                  </ngb-accordion>
                </div>
              </ul>
            </ng-template>
          </ngb-panel>
        </ngb-accordion>
      </div>
      <div *ngIf="isOwner">
        <button (click)="createApplication(selected)" class="btn btn-primary">Apply For Job!</button>
      </div>
      <button (click)="returnToList()" class="btn btn-primary">Back</button>
    </div>
  </div>
</div>
